#LyX 2.0 created this file. For more info see http://www.lyx.org/
\lyxformat 413
\begin_document
\begin_header
\textclass article
\begin_preamble
\usepackage{times}
\usepackage{graphics,natbib}

\newcommand{\matern}{Mat\'{e}rn }
\newcommand{\N}{\mathcal{N}}
\end_preamble
\use_default_options true
\begin_modules
knitr
\end_modules
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize 12
\spacing single
\use_hyperref false
\papersize default
\use_geometry true
\use_amsmath 1
\use_esint 1
\use_mhchem 1
\use_mathdots 1
\cite_engine natbib_authoryear
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 1in
\topmargin 1in
\rightmargin 1in
\bottommargin 1in
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Statistically-estimated tree composition for the northeastern United States
 
\begin_inset Newline newline
\end_inset

at the time of European settlement
\end_layout

\begin_layout Quote
Christopher J.
 Paciorek, Andrew Thurman, Simon J.
 Goring, Charlie V.
 Cogbill, 
\begin_inset Newline newline
\end_inset

John W.
 Williams, David J.
 Mladenoff, Jody A.
 Peters, Jun Zhu, 
\begin_inset Newline newline
\end_inset

and Jason S.
 McLachlan [author order to be discussed]
\begin_inset Newline newline
\end_inset

[please tell me if you do/don't want your middle initial]
\end_layout

\begin_layout Standard
TODO:
\end_layout

\begin_layout Standard
look through code and labbook to make sure have all details
\end_layout

\begin_layout Standard
properly cite Goring stuff and reference details of data collection
\end_layout

\begin_layout Standard
focus on PLOS One, but Nature's Scientific Data is a possibility
\end_layout

\begin_layout Chunk
<<setup, echo=FALSE>>= 
\end_layout

\begin_layout Chunk
inputDir <- '/var/tmp/paciorek/paleon/comp/output'
\end_layout

\begin_layout Chunk
version <- 0.3
\end_layout

\begin_layout Chunk
@
\end_layout

\begin_layout Abstract
We present a data product of the estimated composition of tree taxa at the
 time of European settlement of the United States and the statistical methodolog
y used to produce the product.
 Composition is defined as the proportion of stems larger than approximately
 X cm diameter at breast height [Charlie? Simon? is X roughly 10?] in 22
 taxonomic groupings, generally at the genus level.
 The data come from settlement survey records that provide raw data that
 are transcribed and then aggregated spatially, giving count data.
 The domain is divided into two regions, western (Indiana through Minnesota)
 and eastern (Ohio to Maine).
 Public Land Survey point data in the western region are aggregated to a
 regular 8 km grid, while data in the eastern region, from Town Proprietor
 Surveys is aggregated at the township level.
 The product is based on a Bayesian statistical model fit to the count data
 that estimates composition on a regular 8 km grid.
 The statistical model allows us to estimate composition at locations with
 no data and to smooth over noise caused by limited counts in locations
 with data.
 Critically, it also allows us to quantify uncertainty in our composition
 estimates.
 We expect this data product to be useful for understanding the state of
 vegetation in the northeastern United States prior to large-scale European
 settlement.
 In addition to specific regional questions, the data product can also serve
 as a baseline against which to investigate how forests and ecosystems change
 after intensive settlement.
\end_layout

\begin_layout Section
Introduction
\end_layout

\begin_layout Standard
Historical datasets provide critical context to understand forest ecology.
 Historical datasets allow researchers to define 'baseline' conditions in
 conservation management, to understand ecosystem processes at decadal and
 centennial scales, and, particularly in regions with widespread land use
 change, to understand the extent to which forest conversion and regeneration
 differ from the original forest cover.
\end_layout

\begin_layout Standard
Euro-American settlement and subsequent land use change occured in a time
 transient fashion across North America, and surveys of vegetation followed
 a similar pattern.
 Early surveys (from 1620 until 1825) in the northeastern United States
 were areal surveys at a township level 
\begin_inset CommandInset citation
LatexCommand citep
key "cogbill2002forests,thompson2013four"

\end_inset

, which we call the Town Proprietor Survey (TPS).
 These surveys reporting percent composition of major tree species using
 sometimes inconsistent common names.
 Later surveys, after the establishment of the Public Land Survey System
 (PLSS) - from 1819 to 1904 - were point estimates along a regular grid,
 with 1 mile spacing 
\begin_inset CommandInset citation
LatexCommand citep
key "schulte2001original, bourdo1956review,goring2015composition"

\end_inset

.
 Survey instructions during the PLSS varied through time, and by point type.
 This required the application of spatially varying correction factors 
\begin_inset CommandInset citation
LatexCommand citep
key "cogbill2015corrections, goring2015composition"

\end_inset

 to accurately assess stem density, basal area and biomass from the early
 settlement records.
\end_layout

\begin_layout Standard
Logging, agriculture and abandonment has left an indelible mark on forests
 in the northeastern United States 
\begin_inset CommandInset citation
LatexCommand citep
key "foster1998land,goring2015composition,rhemtulla2009legacies,thompson2013four"

\end_inset

, however most studies have studied these effects at the state level or
 below 
\begin_inset CommandInset citation
LatexCommand citep
key "rhemtulla2009historical,friedman2005regional"

\end_inset

, and with varying spatial resolution, from townships (36 square miles)
 to forest zones of hundreds or thousands of square miles.
 
\begin_inset CommandInset citation
LatexCommand citet
key "goring2015composition"

\end_inset

 provide a dataset across the upper Midwest that is resolved to an 8 x 8
 km grid size, providing broad spatial coverage at a meso-spatial scale
 that can be compared to the Forest Inventory and Analysis products 
\begin_inset CommandInset citation
LatexCommand citet
key "gray2012forest"

\end_inset

.
 The limitation of this dataset is that it provides only estimates of variance
 within cell for PLSS data in the western region, and no township estimates
 of error for regions surveyed as part of the Town Proprietor Survey.
\end_layout

\begin_layout Standard
Properly assessing uncertainty in ecological data is imperative to understanding
 and modelling ecological processes 
\begin_inset CommandInset citation
LatexCommand citep
key "cressie2009accounting"

\end_inset

.
 In this way, a model that can account for the spatial structure of the
 underlying PLSS and TPS data, and provide reliable estimates of uncertainty
 across the northeastern United States provides an enormously valuable tool
 for researchers interested in the ecological structure and function of
 forests at longer time scales.
\end_layout

\begin_layout Section
Data
\end_layout

\begin_layout Standard
The raw data are obtained from survey records collated from across the northeast
ern U.S.
 by a number of researchers.
 For the states of Minnesota, Wisconsin, Illinois, Indiana, and Michigan
 (the western subdomain), data are available at survey point locations and
 have been aggregated to a regular 8 km grid in the Albers projection.
 (Note that for Indiana and Illinois, at the moment trees are associated
 with township centroids and then assigned to 8 km grid cells based on the
 centroid but in the near future we will have point locations available
 for each tree.) For the states of Ohio, Pennsylvania, New Jersey, New York
 and the six New England states (the eastern subdomain), data are aggregated
 at the township level.
 There is also data from a single township in Quebec and a single township
 in northern Delaware.
 Data are essentially complete in Minnesota, Wisconsin and Michigan but
 data in Illinois and Indiana represent a sample of the full set of grid
 cells, with survey record transcription ongoing.
 Data for the remaining states are a subset of the full set of townships.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:domain"

\end_inset

 [Fig.
 1 - Lyx is having a numbering problem] shows the domain, indicating the
 grid cells and townships with data.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:domain"

\end_inset


\begin_inset Graphics
	filename fig1.pdf

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Spatial domain, with locations with data shown in gray.
 Locations are grid cells in western portion and townships in eastern portion.
 [FIX plot so that S IL border is not omitted]
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Note that surveys occurred over a period of more than 200 years as European
 colonists (before U.S.
 independence) and the United States settled what is now the northeastern
 United States.
 Our estimates are for the period of settlement represented by the survey
 data and therefore are time-transgressive; they do not represent any single
 point in time across the domain, but rather the state of the landscape
 at the time just before settlement occurred [get ref from Charlie or Jason's
 historian pal]
\end_layout

\begin_layout Standard
Extensive details on the data are available in
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
cite{Gori:etal:2015}
\end_layout

\end_inset

 and the raw data are available at XXX.
 The aggregation into taxonomic groups is primarily at the genus level,
 but in some cases of monospecific genera, is at the species level.
 We model the following 22 taxa plus an 
\begin_inset Quotes eld
\end_inset

other hardwood
\begin_inset Quotes erd
\end_inset

 category: Atlantic white cedar (Chamaecyparis thyoides), Ash (Fraxinus
 spp.), Basswood (Tilia americana), Beech (Fagus grandifolia), Birch (Betula
 spp.), Black gum/sweet gum (Nyssa sylvatica and Liquidambar styraciflua),
 Cedar/juniper (what is in here other than Juniperus and is the Juniperus
 only Juniperus virginiana), Cherry (Prunus spp.), Chestnut (Castanea dentata),
 Dogwood (Cornus spp.), Elm (Ulmus spp.
 or Ulmus americana???) , Fir (Abies spp.), Hemlock (Tsuga canadensis), Hickory
 (Carya spp.), Ironwood (Carpinus caroliniana and Ostrya virginiana (anything
 else?)), Maple (Acer spp.), Oak (Quercus spp.), Pine (Pinus spp.), Poplar/tulip
 poplar (Populus spp.
 and Liriodendron tulipifera), Spruce (Picea spp.), Tamarack (Larix laricina),
 Walnut (Juglans nigra).
 [Simon/Charlie to check my Latin and whether I've left out anything that
 falls into a given common name] Note that in several cases (e.g., black gum/sweet
 gum, ironwood, poplar/tulip poplar, cedar/juniper), because of ambiguity
 in the common tree names used by surveyors, a group represents trees from
 different families and even orders.
 For the western subdomain we do not fit statistical models for Atlantic
 white cedar and chestnut as these have 0 and 5 trees present in the dataset,
 respectively.
 The taxa grouped into other hardwood are those for which fewer than roughly
 3000 trees were present in the dataset.
\end_layout

\begin_layout Standard
[include description of size cutoff] [Simon, Jody mentioned that ther are
 402 trees in IN below ~10 cm and at least 43 in IL.
 Do you screen those out or do we just live with it?]
\end_layout

\begin_layout Standard
There are approximately 520,000 trees from the western subdomain and 420,000
 trees from the eastern subdomain [fix this].
 In each subdomain, oak is the most common taxon and pine the second most
 common.
 
\end_layout

\begin_layout Standard
Our domain is a rectangle covering all of the states, in the Albers projection
 (NAD 1983 Great Lakes and St.
 Lawrence Albers) [Simon, please confirm this language is right], with the
 rectangle split into 8 km cells, arranged in a 296 by 180 grid of cells,
 with the centroid of the cell in the southeast corner located at (-71000,
 58000).
 For the modeling of the western subdomain we use the western-most 146 by
 180 grid of cells.
 For the modeling of the eastern subdomain we use the eastern-most 180 by
 180 grid of cells and then omit 23 cells in the north and 17 cells in the
 south.
 [check 23 in N vs 17 in N; also check what is in netCDF product - should
 be for the full domain with missing values?]
\end_layout

\begin_layout Section
Statistical model
\end_layout

\begin_layout Standard
We fit a Bayesian statistical model to the data, with two primary goals:
\end_layout

\begin_layout Enumerate
To estimate composition on a regular grid across the entire domain, filling
 gaps where no data are available, and
\end_layout

\begin_layout Enumerate
To quantify uncertainty in composition at all locations.
 Even in grid cells and townships with data, we wish to quantify uncertainty
 because the empirical proportions represent estimates of the true proportions
 based on the full population of all the trees in an areal region.
\end_layout

\begin_layout Standard
The result of fitting the Bayesian model via Markov chain Monte Carlo (MCMC)
 is a set of representative samples from the posterior distribution for
 the composition of the taxa at all of the grid cells.
 These samples are the data product and can then be used in analyses.
 We also provide the mean and standard deviation of the samples, which represent
 our best estimate of composition and a Bayesian 
\begin_inset Quotes eld
\end_inset

standard error
\begin_inset Quotes erd
\end_inset

 for the estimate.
 
\end_layout

\begin_layout Subsection
Data model
\end_layout

\begin_layout Standard
The statistical model treats the observations as having a multinomial distributi
on with a (latent) vector of proportions for each grid cell.
 
\begin_inset Formula 
\[
y_{i}\sim\mbox{Multi}(n_{i},\theta(s_{i}))
\]

\end_inset

where 
\begin_inset Formula $y_{i}$
\end_inset

 is the vector of counts for the 
\begin_inset Formula $P$
\end_inset

 taxa at the 
\begin_inset Formula $i$
\end_inset

th location, 
\begin_inset Formula $n_{i}$
\end_inset

 is the number of trees counted in the location, and 
\begin_inset Formula $\theta(s_{i})$
\end_inset

 is the vector of unknown proportions for those taxa at that location.
 Note that we use a standard multinomial distribution without overdispersion
 as the set of trees in the dataset is roughly uniformly sampled across
 the cells or townships 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Gori:etal:2015}
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
In what follows we describe the basic model for those states for which we
 have raw data on the 8 km grid and in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Model-for-township"

\end_inset

 we describe the extension of the model to accommodate data aggregated to
 the township level.
\end_layout

\begin_layout Standard
The proportions, 
\begin_inset Formula $\theta_{p}(s_{i}),\, p=1,\ldots,P$
\end_inset

, are modeled spatially by a set of 
\begin_inset Formula $P$
\end_inset

 Gaussian spatial processes, one per taxon, 
\begin_inset Formula $\alpha_{p}(s_{i}),\, p=1,\ldots,P$
\end_inset

.
 This collection of processes defines a multivariate spatial process for
 composition.
 The 
\begin_inset Formula $\alpha_{p}(s)$
\end_inset

 processes are defined on the 8 km grid, 
\begin_inset Formula $\alpha_{p}=\{\alpha_{p}(s_{1}),\ldots,\alpha_{p}(s_{m})\}$
\end_inset

 for the 
\begin_inset Formula $m$
\end_inset

 grid cells.
 In Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Latent-Variable-Model"

\end_inset

 we introduce a multinomial probit model that relates the 
\begin_inset Formula $\alpha_{p}(s)$
\end_inset

 processes to the proportion processes, 
\begin_inset Formula $\theta_{p}(s)$
\end_inset

, via the introduction of latent variables, with an implicit sum-to-one
 constraint, 
\begin_inset Formula $\sum_{p=1}^{P}\theta_{p}(s)=1$
\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
At each grid cell, the proportions necessarily sum to one; this constraint
 is imposed via the log-ratio transformation, which defines the proportion
 for taxon 
\begin_inset Formula $p$
\end_inset

 at cell 
\begin_inset Formula $i$
\end_inset

 to be
\begin_inset Formula 
\[
\theta_{p}(s_{i})=\frac{\log(\alpha_{p}(s_{i}))}{\sum_{j=1}^{P}\exp(\alpha_{j}(s_{i})};
\]

\end_inset

This transformation is the multivariate analogue of the logit transformation.
 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The critical component of the statistical model is the representation of
 
\begin_inset Formula $\alpha_{p}(s)$
\end_inset

 as a spatial process.
 This process is a prior structure that serves to smooth across noise in
 the observations and allows for interpolation to locations with no data.
 Apart from the sum to one constraints, the taxa are considered to be independen
t in the prior, as we did not want to impose any structure that ties the
 different taxa together, as any correlation will likely vary across space.
\end_layout

\begin_layout Standard
In the next section, we consider two spatial models to define the structure
 of the 
\begin_inset Formula $\alpha_{p}(s)$
\end_inset

 processes, a standard conditional autoregressive model 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Bane:etal:2003}
\end_layout

\end_inset

 and a Gaussian Markov random field (MRF) approximation to a Gaussian process
 with Matern covariance 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Lind:etal:2011}
\end_layout

\end_inset

.
 
\end_layout

\begin_layout Subsection
Spatial process models
\end_layout

\begin_layout Standard
MRF models work directly with the precision matrix of the values of the
 spatial process, so calculation of the prior density of 
\begin_inset Formula $\alpha_{p}(s)$
\end_inset

 is computationally simple 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Rue:Held:2005}
\end_layout

\end_inset

, but in situations where the likelihood is not normal, it can be difficult
 to set up effective MCMC algorithms that are able to move in the high-dimension
al space of 
\begin_inset Formula $\alpha_{p}$
\end_inset

.
 The latent variable representation of Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Model-for-township"

\end_inset

 helps to alleviate this problem.
\end_layout

\begin_layout Subsubsection
Standard conditional autoregressive models
\end_layout

\begin_layout Standard
Our first model is a standard conditional autoregressive (CAR) model 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Bane:etal:2003}
\end_layout

\end_inset

.
 We use a standard form of this model, which treats the four cardinal neighbors
 of each grid cell as the neighbors of the grid cell.
 The corresponding precision matrix has diagonal elements, 
\begin_inset Formula $Q_{ii}$
\end_inset

, equal to the number of neighbors for the 
\begin_inset Formula $i$
\end_inset

th area (i.e., four except for cells on the boundary of the domain), while
 
\begin_inset Formula $Q_{ik}=-1$
\end_inset

 (the negative of a weight of one) when areas 
\begin_inset Formula $i$
\end_inset

 and 
\begin_inset Formula $k$
\end_inset

 are neighbors and 
\begin_inset Formula $Q_{ik}=0$
\end_inset

 when they are not.
 This gives the following model for the values of 
\begin_inset Formula $\alpha_{p}(s_{i})$
\end_inset

 collected as a vector across all of the grid cells, 
\begin_inset Formula $i=1,\ldots,m$
\end_inset

: 
\begin_inset Formula 
\[
\alpha_{p}\sim\mbox{N}(0,\sigma_{p}^{2}Q^{-})
\]

\end_inset

The use of the generalized inverse notation indicates that 
\begin_inset Formula $Q$
\end_inset

 is not full-rank, but is of rank 
\begin_inset Formula $m-1$
\end_inset

; this gives an improper prior on an implicit overall mean for the process
 values.
 This specification is called an 
\shape italic
intrinsic conditional autoregression (ICAR)
\shape default
 and 
\begin_inset Formula $Q$
\end_inset

 can also be expressed as 
\begin_inset Formula $D-C$
\end_inset

 where 
\begin_inset Formula $C$
\end_inset

 is the 
\begin_inset Formula $m\times m$
\end_inset

 adjacency matrix defining the neighborhood relation of the locations; that
 is 
\begin_inset Formula $(C)_{ik}=1$
\end_inset

 if locations 
\begin_inset Formula $i$
\end_inset

 and 
\begin_inset Formula $k$
\end_inset

 are neighbors.
 The matrix 
\begin_inset Formula $D$
\end_inset

 is an 
\begin_inset Formula $m\times m$
\end_inset

 diagonal matrix containing the row sums of matrix 
\begin_inset Formula $C$
\end_inset

 as the diagonal entries 
\begin_inset Formula $(D)_{ii}={\displaystyle \sum_{k=1}^{m}(C)_{ik}}.$
\end_inset


\end_layout

\begin_layout Standard
We refer to this as the 
\emph on
CAR model
\emph default
.
\end_layout

\begin_layout Subsubsection
Gaussian process approximation
\end_layout

\begin_layout Standard
Gaussian processes (GP) are also standard models for spatial processes
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
citep{Bane:etal:2003}
\end_layout

\end_inset

.
 GP models are computationally challenging for large datasets because of
 manipulations involving large covariance matrices.
 Given this, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
cite{Lind:etal:2011}
\end_layout

\end_inset

 proposed a new framework for using Gaussian MRFs (GMRFs) as approximations
 to GPs, based on the use of stochastic partial differential equations (SPDE).
\end_layout

\begin_layout Standard
We consider Gaussian processes in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
matern
\end_layout

\end_inset

 class, using the following parameterization of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
matern
\end_layout

\end_inset

 correlation function as 
\begin_inset Formula 
\begin{equation}
R(d)=\frac{1}{\Gamma(\nu)2^{\nu-1}}\left(\frac{2\sqrt{\nu}d}{\rho}\right)^{\nu}\mathcal{K}_{\nu}\left(\frac{2\sqrt{\nu}d}{\rho}\right),\label{eq:Matern}
\end{equation}

\end_inset

where 
\begin_inset Formula $d$
\end_inset

 is Euclidean distance, 
\begin_inset Formula $\rho$
\end_inset

 is the spatial range parameter, and 
\begin_inset Formula $\mathcal{K}_{\nu}(\cdot)$
\end_inset

 is the modified Bessel function of the second kind, whose order is the
 smoothness (differentiability) parameter, 
\begin_inset Formula $\nu>0$
\end_inset

.
 
\begin_inset Formula $\nu=0.5$
\end_inset

 gives the exponential covariance.
 For any pair of locations, 
\begin_inset Formula $R(d)$
\end_inset

 defines the correlation of the process, e.g., 
\begin_inset Formula $\alpha_{p}(s)$
\end_inset

, as a function of the distance between the locations.
 Considering all pairs of locations, this defines a correlation matrix for
 all locations of interest.
 
\end_layout

\begin_layout Standard
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citet{Lind:etal:2011}
\end_layout

\end_inset

 approach allows us to consider MRF approximations to the Matern-based GPs
 for 
\begin_inset Formula $\nu=1$
\end_inset

 and 
\begin_inset Formula $\nu=2$
\end_inset

.
 Our second model is the Lindgren approximation for Matern-based GPs with
 
\begin_inset Formula $\nu=1$
\end_inset

.
 To implement the Lindgren model, one modifies the 
\begin_inset Formula $Q$
\end_inset

 matrix defined previously as follows.
 Let 
\begin_inset Formula $a=4+\frac{1}{\rho^{2}}$
\end_inset

.
 The diagonal elements of 
\begin_inset Formula $Q$
\end_inset

 are 
\begin_inset Formula $4+a^{2}$
\end_inset

.
 The entries corresponding to cardinal neighbors are 
\begin_inset Formula $-2a$
\end_inset

.
 Those for diagonal neighbors are 
\begin_inset Formula $2$
\end_inset

 and those for 2nd-order cardinal neighbors are 
\begin_inset Formula $1$
\end_inset

.
 This extends the neighborhood structure relative to the CAR model and parameter
izes it as a function of 
\begin_inset Formula $\rho$
\end_inset

.
\end_layout

\begin_layout Standard
The primary difference between the CAR and Lindgren models is that the Lindgren
 model provides an additional degree of freedom by estimating 
\begin_inset Formula $\rho$
\end_inset

.
 In particular 
\begin_inset Formula $\rho$
\end_inset

 allows us to estimate the locality of the smoothing.
 As 
\begin_inset Formula $\rho$
\end_inset

 decreases, the model uses more and more local data to estimate the compositiona
l proportions at a given location, effectively averaging the empirical proportio
ns over smaller neighborhoods.
 In general, the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
cite{Lind:etal:2011}
\end_layout

\end_inset

 model will generally provide for a smoother estimate than the CAR model
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Paci:2013}
\end_layout

\end_inset

.
 
\end_layout

\begin_layout Standard
To ensure that the 
\begin_inset Formula $\sigma^{2}$
\end_inset

 parameter is equivalent between the two models, we reparameterize, producing
 our second model:
\begin_inset Formula 
\[
\alpha_{p}\sim\mbox{N}(\mu_{p},\sigma_{p}^{2}\cdot\frac{4\pi}{\rho_{p}^{2}}Q(\rho_{p})^{-1})
\]

\end_inset


\end_layout

\begin_layout Standard
We refer to this model as the 
\emph on
SPDE model
\emph default
.
\end_layout

\begin_layout Subsection
Prior Distributions
\end_layout

\begin_layout Standard
\noindent
The ICAR specification contains a set of hyperparameters 
\begin_inset Formula $\sigma_{p}^{2}$
\end_inset

 for 
\begin_inset Formula $p$
\end_inset

 = 
\begin_inset Formula $1,...,P$
\end_inset

.
 Following 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Gelm:2006}
\end_layout

\end_inset

 we use a uniform distribution on each 
\begin_inset Formula $\sigma_{p}$
\end_inset

 parameter, with upper bound of [check max values].
 For the SPDE model we also have parameters 
\begin_inset Formula $\mu_{p}$
\end_inset

, which we give flat, non-informative priors (truncated at 
\begin_inset Formula $\pm10$
\end_inset

), and 
\begin_inset Formula $\rho_{p}$
\end_inset

 which we give uniform priors on the interval 
\begin_inset Formula $(0.1,\exp(5))$
\end_inset

.
 
\end_layout

\begin_layout Subsection
Latent Variable Model
\begin_inset CommandInset label
LatexCommand label
name "sub:Latent-Variable-Model"

\end_inset


\end_layout

\begin_layout Standard
It is well-known that devising an effective MCMC algorithm for models with
 latent Gaussian process(es) and a non-Gaussian likelihood is difficult
 (cite recent cent/noncent papers).
 To develop an algorithm, we make use of a latent variable representation
 for the multinomial probit model 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{McCu:Ross:1994}
\end_layout

\end_inset

.
 The representation introduces latent variables that allow one to develop
 a MCMC sampling strategy that takes advantage of closed form full conditional
 distributions (so-called Gibbs sampling steps) for 
\begin_inset Formula $\alpha_{p}$
\end_inset

.
\end_layout

\begin_layout Standard
Suppose that compositional counts are available at a number of locations.
 At location 
\begin_inset Formula $i$
\end_inset

, a sample size of 
\begin_inset Formula $n_{i}$
\end_inset

 observations are collected, and each observation (i.e., each tree) can be
 classified into 
\begin_inset Formula $P$
\end_inset

 distinct categories.
 For a given tree 
\begin_inset Formula $j$
\end_inset

 at location 
\begin_inset Formula $i$
\end_inset

, let 
\begin_inset Formula $Y_{ij}$
\end_inset

 denote the response variable indicating the category.
 Let 
\begin_inset Formula $Y_{ij}$
\end_inset

 be associated with 
\begin_inset Formula $P$
\end_inset

 latent variables 
\begin_inset Formula $W_{ij1},...,W_{ijP}$
\end_inset

 such that 
\begin_inset Formula $Y_{ij}$
\end_inset

 = 
\begin_inset Formula $p$
\end_inset

 if and only if 
\begin_inset Formula $W_{ijp}={\displaystyle \max_{p'}\big\{ W_{ijp'}\big\}}$
\end_inset

; in other words, the maximum of the set of latent variables 
\begin_inset Formula $\{W_{ijp}\}{\displaystyle _{p=1}^{P}}$
\end_inset

 determines the category of observation 
\begin_inset Formula $j$
\end_inset

 at location 
\begin_inset Formula $i$
\end_inset

.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
Define 
\begin_inset Formula $W$
\end_inset


\begin_inset Formula $=(W_{ijp},j=1,...,n_{i},i=1,...,N,p=1,...,P)^{T}$
\end_inset

 and 
\begin_inset Formula $Y$
\end_inset


\begin_inset Formula $=(Y_{ij},j=1,...,n_{i},i=1,...,I)^{T}$
\end_inset

.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Let 
\begin_inset Formula $\pi(A|B)$
\end_inset

 denote the conditional probability density function of a random variable
 
\begin_inset Formula $A$
\end_inset

 conditional on a random variable 
\begin_inset Formula $B$
\end_inset

.
 The response variable model is 
\begin_inset Formula 
\begin{align}
\pi(y|w)={\displaystyle \prod_{i=1}^{I}{\displaystyle \prod_{j=1}^{n_{i}}{\displaystyle \prod_{p=1}^{P}I(w_{ijy_{ij}}\geq w_{ijp}),}}}\label{likelihood}
\end{align}

\end_inset

where 
\begin_inset Formula $I(\cdot)$
\end_inset

 is an indicator function.
 Conditional on 
\begin_inset Formula $W_{ijp},p=1,...,P$
\end_inset

, the probability mass function of 
\begin_inset Formula $Y_{ij}$
\end_inset

 is a point mass on 
\begin_inset Formula $p$
\end_inset

 such that 
\begin_inset Formula $W_{ijp}$
\end_inset

 = 
\begin_inset Formula ${\displaystyle \max_{p^{*}}\big\{ W_{ijp^{*}}\big\}}$
\end_inset

.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\noindent
The final piece of the latent variable representation is the relationship
 between the 
\begin_inset Formula $W$
\end_inset

 variables and the 
\begin_inset Formula $\alpha_{p}(s)$
\end_inset

 processes.
 We have that
\end_layout

\begin_layout Standard
\noindent
\begin_inset Formula 
\[
W_{ijp}\sim\mbox{N}(\alpha_{p}(s_{i}),1)
\]

\end_inset

independently for all of the 
\begin_inset Formula $W_{ijp}$
\end_inset

 values.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
\noindent
where 
\begin_inset Formula $j=1,...,n_{i},i=1,...,I,$
\end_inset

 and 
\begin_inset Formula $p=1,...,P$
\end_inset

.
 Here, 
\begin_inset Formula $\alpha_{ip}$
\end_inset

 is the conditional mean of 
\begin_inset Formula $W_{ijp}$
\end_inset

 for location 
\begin_inset Formula $i$
\end_inset

 and category 
\begin_inset Formula $p$
\end_inset

, and 
\begin_inset Formula $\{W_{ijp},j=1,...,n_{i}\}$
\end_inset

 are identically-distributed for 
\begin_inset Formula $i=1,...,I$
\end_inset

 and 
\begin_inset Formula $p=1,...,P$
\end_inset

,.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\noindent
Consider the following example with two locations that are neighbors and
 
\begin_inset Formula $P=2$
\end_inset

 categories.
 Each tree 
\begin_inset Formula $j$
\end_inset

 at location 
\begin_inset Formula $i$
\end_inset

 is associated with two variables 
\begin_inset Formula $W_{ij1}$
\end_inset

 and 
\begin_inset Formula $W_{ij2}$
\end_inset

, governed by the latent variables 
\begin_inset Formula $\alpha_{i1}$
\end_inset

 and 
\begin_inset Formula $\alpha_{i2}$
\end_inset

, respectively.
 Suppose that 
\begin_inset Formula $\alpha_{i1}>\alpha_{i2}$
\end_inset

 for a given location 
\begin_inset Formula $i$
\end_inset

.
 Then this model implies that any tree 
\begin_inset Formula $j$
\end_inset

 is more likely to be labeled 1 than 2 at location 
\begin_inset Formula $i$
\end_inset

.
 The difference between 
\begin_inset Formula $\alpha_{i1}$
\end_inset

 and 
\begin_inset Formula $\alpha_{i2}$
\end_inset

 explains the 
\shape italic
difference
\shape default
 in probability of 
\shape italic
categories
\shape default
 1 and 2 at location 
\begin_inset Formula $i$
\end_inset

, and the similarity between 
\begin_inset Formula $\alpha_{1p}$
\end_inset

 and 
\begin_inset Formula $\alpha_{2p}$
\end_inset

 explains the 
\shape italic
correlation
\shape default
 between the probabilities at 
\shape italic
locations
\shape default
 1 and 2 for category 
\begin_inset Formula $p$
\end_inset

.
\end_layout

\begin_layout Subsection
Model for township data
\begin_inset CommandInset label
LatexCommand label
name "sub:Model-for-township"

\end_inset


\end_layout

\begin_layout Standard
We developed an extension of the model described in previous sections to
 account for data at a different aggregation than our core 8 km grid.
 This extension introduces a new set of latent variables, one per tree,
 that indicate the grid cell in which the tree is located.
 These latent 'membership' variables, 
\begin_inset Formula $c_{tj}$
\end_inset

, for tree 
\begin_inset Formula $j$
\end_inset

 in township 
\begin_inset Formula $t$
\end_inset

 can be sampled within the MCMC as additional unknown parameters.
 The prior for 
\begin_inset Formula $c_{tj}$
\end_inset

 is a discrete distribution that puts mass proportional to the overlap between
 the township in which the tree is located and the grid cells that intersect
 the township, 
\begin_inset Formula $\psi_{1(t)},\ldots,\psi_{T(t)}$
\end_inset

, with the priors across different trees in a township being independent.
 
\begin_inset Formula 
\[
c_{tj}\sim\mbox{Multinom}(1,\{\psi_{1(t)},\ldots\psi_{T(t)}\}).
\]

\end_inset


\end_layout

\begin_layout Standard
In updating the other parameters in the model, we condition on the current
 values, 
\begin_inset Formula $c_{tj}$
\end_inset

, which provides a 
\begin_inset Quotes eld
\end_inset

soft
\begin_inset Quotes erd
\end_inset

 assignment of trees to grid cells that respects both the township in which
 the tree was sampled and the uncertainty in which grid cell the tree was
 sampled.
\end_layout

\begin_layout Standard
Note that this prior has the unrealistic feature that it does not represent
 our knowledge that the trees in a township would be distributed more regularly
 across the area of the township than expected by such an independence prior.
\end_layout

\begin_layout Subsection
Computation
\end_layout

\begin_layout Standard
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
cite{McCu:Ross:1994}
\end_layout

\end_inset

 representation is convenient for MCMC sampling, particularly in this high-dimen
sional spatial context, as it allows us to draw from the posterior conditional
 distribution of the 
\begin_inset Formula $W_{ijp}$
\end_inset

 variables (these distributions are truncated normal) in closed form and
 to draw the entire vector of latent process values, 
\begin_inset Formula $\alpha_{p}$
\end_inset

, as a single sample that respects the spatial dependence structure for
 each taxon.
\end_layout

\begin_layout Standard
While the latent variable representation provides great advantages in the
 MCMC sampling for each 
\begin_inset Formula $\alpha_{p}$
\end_inset

 compared to joint Metropolis updates or single location at a time updates,
 there is still strong dependence between the hyperparameters, 
\begin_inset Formula $\{\sigma_{p}^{2},\mu_{p},\rho_{p}\}$
\end_inset

 and the the latent process values (as well as between the latent process
 values and the latent 
\begin_inset Formula $W_{ijp}$
\end_inset

 variables).
 To address the first, we developed a 'cross-level' joint updating strategy
 in which we propose 
\begin_inset Formula $\phi\in\{\sigma_{p}\},p=1,\ldots,P$
\end_inset

 and for the SPDE model, 
\begin_inset Formula $\phi\in\{\{\sigma_{p}\},\{\mu_{p}\},\{\rho_{p}\}\},$
\end_inset

 via a Metropolis-style random walk and then conditional on the proposed
 value of 
\begin_inset Formula $\phi$
\end_inset

 propose 
\begin_inset Formula $\alpha_{p}$
\end_inset

 from its full conditional distribution 
\backslash

\begin_inset Formula $\alpha_{p}$
\end_inset

 and sampling from the marginalized distribution 
\begin_inset Formula $\phi|W$
\end_inset

.
 Note that in sampling 
\begin_inset Formula $\sigma_{p}$
\end_inset

and 
\begin_inset Formula $\rho_{p}$
\end_inset

 in the SPDE model, for each 
\begin_inset Formula $p$
\end_inset

, we jointly propose 
\begin_inset Formula $\{\sigma_{p},\rho_{p}\}$
\end_inset

 using an adaptive Metropolis proposal and then use the cross-level strategy
 to also propose 
\begin_inset Formula $\alpha_{p}$
\end_inset

 as part of a single accept-reject step.
 For these various joint samples of hyperparameters and 
\begin_inset Formula $\alpha_{p}$
\end_inset

, we use adaptive Metropolis sampling 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Shab:Well:2011}
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
The full description of the MCMC sampling steps is provided in the Appendix.
 In addition, in the latent variable representation, 
\begin_inset Formula $\theta_{p}(s)$
\end_inset

 never appears explicitly and cannot be calculated in close form.
 Instead we use Monte Carlo integration over 
\begin_inset Formula $W_{ijp},\, p=1,\ldots,P$
\end_inset

 to estimate 
\begin_inset Formula $\theta_{p}(s_{i})$
\end_inset

, also described in the Appendix.
 
\end_layout

\begin_layout Standard
The model is implemented in R with core computational calculations coded
 in C++ using the Rcpp package 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Edde:Fran:2011}
\end_layout

\end_inset

.
 We also make extensive use of sparse matrix representations and algorithms,
 using the spam package in R 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Furr:Sain:2010}
\end_layout

\end_inset

.
 All code is available on Github, including pre- and post-processing code.
 
\end_layout

\begin_layout Section
Model comparison
\end_layout

\begin_layout Subsection
Design
\end_layout

\begin_layout Standard
We compared the CAR and SPDE models using cross-validation by holding out
 data from the fitting process and assessing the fit of the model on the
 held-out data.
 We used two types of test data:
\end_layout

\begin_layout Enumerate
We held out all the data from 95% of the cells in Minnesota, with cells
 selected at random.
 This was meant to assess the ability of the model to interpolate from a
 sparse set of cells/townships and mimics the limited data in Illinois and
 Indiana
\begin_inset Note Note
status open

\begin_layout Plain Layout
( and southern Michigan?)
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
We held out 5% of the trees from all of the trees in the dataset (leaving
 aside the held-out Minnesota cells).
 This was meant to assess the ability of the model to estimate the composition
 in cells in which data were available.
 
\end_layout

\begin_layout Standard
Finally, in a separate sensitivity analysis we instead left out 80% of the
 cells in Minnesota at random.
 This variation on the first test above was meant to indicate whether our
 model comparison conclusions would be robust as the digitization process
 for Illinois and Indiana progresses and provides us with increasingly dense
 data.
\end_layout

\begin_layout Standard
There has been extensive work in the statistical literature on good metrics
 to use to compare the predictive ability of models; these metrics are referred
 to as scoring rules.
 In particular it is well-recognized that predictive distributions should
 maximize sharpness subject to calibration.
 That is the predictive distribution should be as narrow as possible while
 being calibrated such that the observations are consistent with the distributio
n 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Gnei:etal:2007}
\end_layout

\end_inset

.
 When thinking in terms of prediction intervals, we seek intervals that
 are as narrow as possible while still covering the truth the expected proportio
n of the time.
 Following the suggestions in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Gnei:etal:2007}
\end_layout

\end_inset

, we consider these metrics.
\end_layout

\begin_layout Standard
We used the following criteria to compare models.
 For experiment 1, 
\begin_inset Formula $Y_{i}=\{Y_{i1},\ldots,Y_{iP}\}$
\end_inset

 is the count of all trees in the held-out cell and for experiment 2, 
\begin_inset Formula $Y_{i}$
\end_inset

 is the count of held-out individual trees in the location.
\end_layout

\begin_layout Enumerate
Brier score: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Gnei:etal:2007}
\end_layout

\end_inset

 suggest this measure, which has been in use for decades.
 For multi-category as opposed to binary outcomes, this takes the form
\begin_inset Formula 
\[
\frac{1}{n_{i}}\sum_{j=1}^{n_{i}}\sum_{p=1}^{P}(y_{ijp}-\theta_{p}(s_{i}))^{2}
\]

\end_inset

for each cell.
 The full Brier score for the complete set of held-out locations sums over
 all locations.
\end_layout

\begin_layout Enumerate
Log predictive density: This measure takes the log of the density of held-out
 observations under the fitted model, 
\begin_inset Formula $Y_{i}\sim\mbox{Multinom}(n_{i},\{\theta_{1}(s_{i}),\ldots,\theta_{P}(s_{i})\})$
\end_inset

, summing on the log scale across all of the held-out data.
 
\end_layout

\begin_deeper
\begin_layout Standard
While in principle, this metric should be optimal 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Krnj:Drap:2014}
\end_layout

\end_inset

, it suffers from a lack of robustness in being very sensitive to small
 predictions near zero 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Gnei:etal:2007}
\end_layout

\end_inset

.
 Even worse, our Monte Carlo estimation of 
\begin_inset Formula $\theta$
\end_inset

 used 10000 samples, so in some cases 
\begin_inset Formula $\theta_{p}(s)=0$
\end_inset

.
 When a tree is present in a cell but its corresponding proportion is 0
 this gives a log density of 
\begin_inset Formula $-\infty$
\end_inset

, preventing use of the metric.
 As an informal solution to this we set 
\begin_inset Formula $\theta_{p}(s)=0.5\frac{1}{10000}$
\end_inset

 in such cases, but given these issues we treat the log predictive density
 as a secondary measure.
\end_layout

\end_deeper
\begin_layout Enumerate
Weighted root mean square prediction error (RMSPE) and mean absolute error
 (MAE) for individual cells (only for experiment 1), where we weight by
 the number of held-out trees to account for the greater variability in
 the empirical proportions in locations with few held-out trees.
 
\end_layout

\begin_layout Enumerate
Coverage and length of 95% prediction intervals for 
\begin_inset Formula $Y_{ip}$
\end_inset

.
 
\end_layout

\begin_layout Standard
For each of these metrics, we calculated the metric using the posterior
 mean composition estimates (as a measure of our core predictions) and averaging
 the metric over the posterior samples (as a measure of our full data product,
 including uncertainty).
 In other words in the first we first average over the composition posterior
 samples and in the second we average of the posterior values of the cross-valid
ation metric.
\end_layout

\begin_layout Standard
In our fitting we noticed that the SPDE model produced boundary effects
 in the predicted composition near the edges of the convex hull of the observati
ons.
 To attempt to alleviate this, we added a buffer zone of 6 grid cells around
 our entire original domain, though the boundary effects were still evident
 even after inclusion of the buffer.
 For the model comparison, for comparability, we included this buffer for
 both the SPDE and CAR models.
 
\end_layout

\begin_layout Standard
For the model comparison, we used an earlier version of the dataset than
 that used for the final data product as the model comparison runs involved
 substantial computation.
 This earlier version had incomplete data for southern Michigan and was
 missing a small number of trees (39 individual trees) classified as 
\begin_inset Quotes eld
\end_inset

other hardwood
\begin_inset Quotes erd
\end_inset

 due to an update to our taxonomic aggregations of common names used by
 surveyors.
 Given that part of the goal of the exercise is to understand the ability
 of the models to interpolate to areas without data and the ongoing nature
 of digitization, we believe this difference in datasets is not an issue.
\end_layout

\begin_layout Standard
We ran each model for XXX iterations, retaining YYY after burnin and subsampling
 to reduce storage needs.
 
\end_layout

\begin_layout Chunk

\end_layout

\begin_layout Chunk

\end_layout

\begin_layout Subsection
Results
\end_layout

\begin_layout Standard
Here we summarize the results of our cross-validation analyses that inform
 the choice between the CAR and SPDE models.
 
\end_layout

\begin_layout Subsubsection
Full cell hold-out experiment
\end_layout

\begin_layout Standard
Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:score_cell_fivepercent"

\end_inset

 shows predictive ability for Experiment 1: those cells in Minnesota held
 out of the fitting process, for both the posterior mean predictions and
 the full posterior sample.
 Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:coverage_cell_fivepercent"

\end_inset

 shows performance of the uncertainty estimates.
 For the posterior distribution over the predictive score values, the CAR
 model generally outperforms the SPDE model, while for the posterior mean
 predictions, the SPDE model appears to outperform the CAR model, but we
 do not have any uncertainty estimates for this comparison.
 Coverage and interval lengths are similar between the two models.
 From a practical perspective, based on the difference in mean absolute
 error, which is on a readily interpretable scale, the differences between
 the models are small.
 
\end_layout

\begin_layout Chunk

\end_layout

\begin_layout Chunk
<<tab1prep, echo=FALSE>>= 
\end_layout

\begin_layout Chunk
setwd(inputDir)
\end_layout

\begin_layout Chunk
for(run in 10:14) {
\end_layout

\begin_layout Chunk
	load(paste0('PLScomposition_western_',version,'-',run,'-cvResults.Rda'))
\end_layout

\begin_layout Chunk
	assign(paste0('results',run), results)
\end_layout

\begin_layout Chunk
	assign(paste0('samples',run), samples)
\end_layout

\begin_layout Chunk
}
\end_layout

\begin_layout Chunk
resultsCAR = results10
\end_layout

\begin_layout Chunk
resultsSPDE = results11
\end_layout

\begin_layout Chunk
resultsTPS = results12
\end_layout

\begin_layout Chunk
samplesCAR = samples10
\end_layout

\begin_layout Chunk
samplesSPDE = samples11
\end_layout

\begin_layout Chunk
postProbsCell <- rep(0, 4)
\end_layout

\begin_layout Chunk
postProbsCell[1] <- mean(samplesCAR[1,'cell',] < samplesSPDE[1,'cell',])
\end_layout

\begin_layout Chunk
postProbsCell[2] <- mean(-samplesCAR[2,'cell',] < -samplesSPDE[2,'cell',])
\end_layout

\begin_layout Chunk
postProbsCell[3] <- mean(samplesCAR[3,'cell',] < samplesSPDE[3,'cell',])
\end_layout

\begin_layout Chunk
postProbsCell[4] <- mean(samplesCAR[4,'cell',] < samplesSPDE[4,'cell',])
\end_layout

\begin_layout Chunk
#val_1_1 = sprintf("%5.0f", resultsCAR['brier','cell','post_mean_of_score'])
\end_layout

\begin_layout Chunk
@
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Predictive ability based on several predictive score criteria for the CAR
 and SPDE spatial models when holding out 95% of entire cells of data in
 Minnesota.
 Smaller values are better.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="6">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="3cm">
<column alignment="center" valignment="top" width="2.5cm">
<column alignment="center" valignment="top" width="2.5cm">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Posterior mean of score
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Score of posterior mean predictions
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
CAR model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
SPDE model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Posterior Prob.
 CAR < SPDE
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
CAR model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
SPDE model
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Brier
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsCAR['brier','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsSPDE['brier','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%1.2f", postProbsCell[1])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsCAR['brier','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsSPDE['brier','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Negative Log Density
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsCAR['logdensity','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsSPDE['logdensity','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%1.2f",postProbsCell[2])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsCAR['logdensity','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsSPDE['logdensity','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Mean Absolute Error
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsCAR['mae','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsSPDE['mae','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%1.2f",postProbsCell[3])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsCAR['mae','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsSPDE['mae','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Root Mean Square Error
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsCAR['mspe','cell','post_mean_of_score']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsSPDE['mspe','cell','post_mean_of_score']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%1.2f",postProbsCell[4])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsCAR['mspe','cell','score_of_post_mean']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsSPDE['mspe','cell','score_of_post_mean']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:score_cell_fivepercent"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Coverage and length of prediction intervals for the CAR and SPDE spatial
 models when holding out 95% of entire cells of data in Minnesota.
 
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="3">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
CAR model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
SPDE model
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Coverage
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsCAR['coverage','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsSPDE['coverage','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Mean Interval Length
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsCAR['mean_int_len','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsSPDE['mean_int_len','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Median Interval Length
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsCAR['median_int_len','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsSPDE['median_int_len','cell','post_mean_of_score'])
}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:coverage_cell_fivepercent"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Predictive ability based on several predictive score criteria for the CAR
 and TPS spatial models when holding out 95% of entire cells of data in
 Minnesota.
 Smaller values are better, except for coverage, where values near 0.95 are
 optimal.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="9" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Posterior mean of score
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Score of posterior mean predictions
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
CAR model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
TPS model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
CAR model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
TPS model
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Brier
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsCAR['brier','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsTPS['brier','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsCAR['brier','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsTPS['brier','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Negative Log Density
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsCAR['logdensity','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsTPS['logdensity','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsCAR['logdensity','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsTPS['logdensity','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Mean Absolute Error
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsCAR['mae','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsTPS['mae','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsCAR['mae','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsTPS['mae','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Root Mean Square Error
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsCAR['mspe','cell','post_mean_of_score']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsTPS['mspe','cell','post_mean_of_score']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsCAR['mspe','cell','score_of_post_mean']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsTPS['mspe','cell','score_of_post_mean']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Coverage
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsCAR['coverage','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsTPS['coverage','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
NA
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
NA
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Mean Interval Length
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsCAR['mean_int_len','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsTPS['mean_int_len','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
NA
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
NA
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Median Interval Length
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsCAR['median_int_len','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsTPS['median_int_len','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
NA
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
NA
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:score_cell_fivepercent-1"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:score_cell_20percent"

\end_inset

 shows the results when the proportion of cells that are held out decreases
 from 95% to 80%, indicating performance on less sparse data.
 Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:coverage_cell_20percent"

\end_inset

 shows performance of the uncertainty estimates.
 For denser data, unlike the results when data are more sparse, the SPDE
 model generally outperforms the CAR model, but again differences from a
 practical perspective, based on mean absolute error, are limited.
\end_layout

\begin_layout Chunk
<<tab2prep, echo=FALSE>>= 
\end_layout

\begin_layout Chunk
resultsCAR = results13
\end_layout

\begin_layout Chunk
resultsSPDE = results14
\end_layout

\begin_layout Chunk
samplesCAR = samples13
\end_layout

\begin_layout Chunk
samplesSPDE = samples14
\end_layout

\begin_layout Chunk
postProbsCell <- rep(0, 4)
\end_layout

\begin_layout Chunk
postProbsCell[1] <- mean(samplesCAR[1,'cell',] < samplesSPDE[1,'cell',])
\end_layout

\begin_layout Chunk
postProbsCell[2] <- mean(-samplesCAR[2,'cell',] < -samplesSPDE[2,'cell',])
\end_layout

\begin_layout Chunk
postProbsCell[3] <- mean(samplesCAR[3,'cell',] < samplesSPDE[3,'cell',])
\end_layout

\begin_layout Chunk
postProbsCell[4] <- mean(samplesCAR[4,'cell',] < samplesSPDE[4,'cell',])
\end_layout

\begin_layout Chunk
#val_1_1 = sprintf("%5.0f", resultsCAR['brier','cell','post_mean_of_score'])
\end_layout

\begin_layout Chunk
@
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Predictive ability based on several predictive score criteria for the CAR
 and SPDE spatial models when holding out 80% of entire cells of data in
 Minnesota.
 Smaller values are better, except for coverage, where values near 0.95 are
 optimal.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="6">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="3cm">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Posterior mean of score
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Score of posterior mean predictions
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
CAR model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
SPDE model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Posterior Prob.
 CAR < SPDE
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
CAR model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
SPDE model
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Brier
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsCAR['brier','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsSPDE['brier','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%1.2f", postProbsCell[1])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsCAR['brier','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsSPDE['brier','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Negative Log Density
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsCAR['logdensity','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsSPDE['logdensity','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%1.2f",postProbsCell[2])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsCAR['logdensity','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsSPDE['logdensity','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Mean Absolute Error
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsCAR['mae','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsSPDE['mae','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%1.2f",postProbsCell[3])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsCAR['mae','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", resultsSPDE['mae','cell','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Root Mean Square Error
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsCAR['mspe','cell','post_mean_of_score']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsSPDE['mspe','cell','post_mean_of_score']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%1.2f",postProbsCell[4])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsCAR['mspe','cell','score_of_post_mean']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.4f", sqrt(resultsSPDE['mspe','cell','score_of_post_mean']))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:score_cell_20percent"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Coverage and length of prediction intervals for the CAR and SPDE spatial
 models when holding out 80% of entire cells of data in Minnesota.
 
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="3">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
CAR model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
SPDE model
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Coverage
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsCAR['coverage','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsSPDE['coverage','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Mean Interval Length
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsCAR['mean_int_len','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsSPDE['mean_int_len','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Median Interval Length
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsCAR['median_int_len','cell','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f", resultsSPDE['median_int_len','cell','post_mean_of_score'])
}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:coverage_cell_20percent"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Individual tree hold-out experiment
\end_layout

\begin_layout Standard
Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:score_tree"

\end_inset

 shows the predictive ability for Experiment 2.
 Here we have limited evidence (posterior probability of 0.84) that the SPDE
 model is better based on the Brier score.
\end_layout

\begin_layout Chunk
<<tab3prep, echo=FALSE>>= 
\end_layout

\begin_layout Chunk
resultsCAR = results10
\end_layout

\begin_layout Chunk
resultsSPDE = results11
\end_layout

\begin_layout Chunk
samplesCAR = samples10
\end_layout

\begin_layout Chunk
samplesSPDE = samples11
\end_layout

\begin_layout Chunk
postProbsTree <- rep(0, 4)
\end_layout

\begin_layout Chunk
postProbsTree[1] <- mean(samplesCAR[1,'tree',] < samplesSPDE[1,'tree',])
\end_layout

\begin_layout Chunk
postProbsTree[2] <- mean(-samplesCAR[2,'tree',] < -samplesSPDE[2,'tree',])
\end_layout

\begin_layout Chunk
#val_1_1 = sprintf("%5.0f", resultsCAR['brier','cell','post_mean_of_score'])
\end_layout

\begin_layout Chunk
@
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Predictive ability based on several predictive score criteria for the CAR
 and SPDE spatial models when holding out 5% of trees.
 Smaller values are better.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="6">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="3cm">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Posterior mean of score
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Score of posterior mean predictions
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
CAR model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
SPDE model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Posterior Prob.
 CAR < SPDE
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
CAR model
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
SPDE model
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Brier
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsCAR['brier','tree','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsSPDE['brier','tree','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%1.2f",postProbsTree[1])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsCAR['brier','tree','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", resultsSPDE['brier','tree','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Negative Log Density
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsCAR['logdensity','tree','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsSPDE['logdensity','tree','post_mean_of_score'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%1.2f",postProbsTree[2])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsCAR['logdensity','tree','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.0f", -resultsSPDE['logdensity','tree','score_of_post_mean'])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:score_tree"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Choice of spatial model
\end_layout

\begin_layout Standard
The differences between models are not consistent across the various comparisons
, so there is not a clear choice.
 In our final data product we use the CAR model, for three reasons.
 First, the CAR model has modestly better performance when data are sparse,
 as is still the case for Illinois and Indiana.
 Second, the model is simpler and easier to explain and computations can
 be done more quickly.
 Third, predictions from the SPDE model showed boundary effects, with taxa
 showing non-negligible posterior mean values at the edges of the domain,
 well away from where the taxon was present in the empirical data.
 This included non-negligible values within (but near the edge of) the convex
 hull of locations with data.
 
\end_layout

\begin_layout Section
Data product
\end_layout

\begin_layout Standard
For the final data product, we ran the model using the CAR specification
 for X iterations, discarding the first Z iterations for burn-in and retaining
 Y to limit storage needs and limit the size of the data product.
 Mixing was generally reasonable, but for some of the hyperparameters was
 relatively slow, particularly for less common taxa.
 Despite this, mixing for the variables of substantive interest, the proportions
 was good.
 [Report ESS values]
\end_layout

\begin_layout Standard
In Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:select_maps"

\end_inset

, we show maps of estimated composition for the full domain for several
 taxa of substantive interest to illustrate the results: beech, cherry,
 chestnut, elm, hemlock, oak, and pine.
 These maps contrast the raw data proportions, the posterior means and posterior
 standard deviations as pointwise estimates of uncertainty.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:all_predictions"

\end_inset

 shows posterior means for all 22 (???) taxa.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:select_maps"

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename fig2.pdf
	scale 75

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hspace{3mm}
\end_layout

\end_inset


\begin_inset Graphics
	filename legendRaw.pdf
	lyxscale 25
	scale 17

\end_inset


\begin_inset Graphics
	filename legendProp.pdf
	lyxscale 25
	scale 17

\end_inset


\begin_inset Graphics
	filename legendSD.pdf
	lyxscale 25
	scale 17

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Empirical proportions from raw data (column 1), posterior mean predictions
 (column 2) and posterior standard deviations -- representing standard errors
 of prediction (column 3) for select taxa.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:all_predictions"

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename /var/tmp/paciorek/paleon/comp_0.2/output/PLScomposition_full_0.1_fits.pdf
	lyxscale 20
	scale 35

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
[THIS IS AN OLD VERSION FOR ILLUSTRATION ONLY - TO BE REPLACED AND PUT IN
 8 ROW X 3 COLUMN FORM WHEN VERSION 0.3 FITS ARE DONE] Posterior mean predictions
 for all taxa over the entire domain.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
While our data product is given for the full rectangular domain, including
 hypothetical vegetation over water, uncertainty is large outside of the
 core states with data and any analysis and inference should only be done
 within those core states.
\end_layout

\begin_layout Standard
The data product is publically available at XX under YY license as version
 1.0 as of January 2015.
 The product is in the form of a netCDF-4 file, with dimensions x, y, and
 MCMC iteration.
 There is one variable per taxon.
 The PalEON project will continue to maintain this product, releasing new
 versions as additional data in Illinois, Indiana and Ohio are digitized.
 
\end_layout

\begin_layout Section
Discussion
\end_layout

\begin_layout Standard
Note that digitization of data from Illinois and Indiana is ongoing and
 digitization of additional data from Ohio is planned as well.
 As a result, at some point we expect to have complete data for the western
 half of the domain.
 There will remain some missing townships in the eastern half of the domain.
 
\end_layout

\begin_layout Standard
Given the density of data and the limited differences seen between the ICAR
 and SPDE models, we expect the data product to be reasonably robust to
 the choice of spatial model, particularly in those areas with complete
 data.
 However, additional investigation of other statistical representations
 is of interest, in particular nonstationary spatial models and use of covariate
s.
 The biggest shortcoming of the current model is its inability to account
 for local features such as rivers (note the Minnesota River floodplain
 in evidence in the raw data).
 The current model, by using a simple stationary spatial model that smooths
 as a function of Euclidean distance, does not account for topographic,
 soil, or other features.
 
\end_layout

\begin_layout Standard
Other related data products that are under development include:
\end_layout

\begin_layout Itemize
The gridded raw count data for the western subdomain and data aggregated
 to township for the eastern subdomain.
 The raw data product is available at XXX and that product provides the
 input data for the product described in this work.
 Note that we cannot provide the raw data at point locations because of
 limitations specified in the data use agreements under which we have access
 to the data.
\end_layout

\begin_layout Itemize
Gridded raw biomass estimates for Minnesota, Wisconsin, and Michigan [right
 Simon, or also for IL and IN] based on the PLS data.
\end_layout

\begin_layout Itemize
Statistically estimated biomass for Minnesota, Wisconsin, and Michigan [also
 IL and IN?] using a statistical model applied to the raw biomass estimates.
\end_layout

\begin_layout Standard
An additional drawback of the product is its focus on composition, which
 does not directly tell us about vegetation structure, in particular does
 not distinguish between closed forest, savanna, and prairie, of particular
 note in Minnesota, Wisconsin, Illinois, and into Indiana.
 The statistically-estimated biomass product mentioned just above will directly
 inform questions about vegetation structure.
 Extensions of that product will also estimate basal area and stem density.
 
\end_layout

\begin_layout Section*
Acknowledgments
\end_layout

\begin_layout Standard
The authors are deeply indebted to all of the researchers over the years
 who have preserved, collected, and digitized survey records, in particular
 Ed Schools (Michigan DNR), { Brugam, ??? - Jody/Charlie/David/Jason/Simon
 please add names here}.
 This work was carried out by the PalEON Project with support from the National
 Science Foundation MacroSystems Program through grants EF-1065656, EF-1241868,
 DEB-1241874 and DEB-1241868.
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bibliographystyle{/accounts/gen/vis/paciorek/latex/RSSstylefile/Chicago}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bibliography{/accounts/gen/vis/paciorek/bibfiles/abbrev.stat,/accounts/gen/vis/pa
ciorek/bibfiles/abbrev.other,/accounts/gen/vis/paciorek/bibfiles/spatstat,/accoun
ts/gen/vis/paciorek/bibfiles/statgeneral,/accounts/gen/vis/paciorek/bibfiles/pac
iorek,/accounts/gen/vis/paciorek/bibfiles/ecology,goring_intro}
\end_layout

\end_inset


\end_layout

\begin_layout Section
Appendix
\end_layout

\begin_layout Subsection
MCMC details
\end_layout

\begin_layout Standard
Define 
\begin_inset Formula $\bar{w}_{i\cdot p}=n_{i}^{-1}{\displaystyle \sum_{j=1}^{n_{i}}W_{ijp}}$
\end_inset

 be the average of the 
\begin_inset Formula $W$
\end_inset

 values for the 
\begin_inset Formula $p$
\end_inset

th taxon in the 
\begin_inset Formula $i$
\end_inset

th grid cell.
 Let 
\begin_inset Formula $A$
\end_inset

 be a diagonal matrix where 
\begin_inset Formula $A_{ii}$
\end_inset

 is the number of trees in the 
\begin_inset Formula $i$
\end_inset

th grid cell.
 When there are no trees in a grid cell, 
\begin_inset Formula $\bar{w}_{i\cdot p}=0$
\end_inset

 and 
\begin_inset Formula $A_{ii}=0$
\end_inset

.
 For the township data, at each iteration, based on the current values of
 the grid cell membership variables, 
\begin_inset Formula $c_{tj}$
\end_inset

, trees are aggregated into grid cells and the calculations above can then
 be carried out.
\end_layout

\begin_layout Standard
The conditional distribution for 
\begin_inset Formula $W_{ijp}$
\end_inset

 given the other unknowns in the model and the data is as follows.
 Let 
\begin_inset Formula $\mbox{TN}(a,b,\mu,\tau^{2})$
\end_inset

 denote the truncated normal distribution with mean parameter 
\begin_inset Formula $\mu$
\end_inset

 and variance parameter 
\begin_inset Formula $\tau^{2}$
\end_inset

, truncated below by 
\begin_inset Formula $a$
\end_inset

 and above by 
\begin_inset Formula $b$
\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align}
W_{ijp} & \sim\begin{cases}
\mbox{TN}\big({\displaystyle \max_{p^{*}\neq y_{ij}}w_{ijp^{*}},\infty,\alpha_{y_{ij}}(s_{i}),1\big),} & \mbox{if }p\mbox{ = \ensuremath{y_{ij}}}\\
\mbox{TN}\big(-\infty,w_{ijy_{ij}},\alpha_{p}(s_{i}),1\big), & \mbox{if }p\mbox{ \ensuremath{\neq y_{ij}}}
\end{cases}\label{sampW}
\end{align}

\end_inset

In essence, the truncation value is determined by the taxon of the 
\begin_inset Formula $j$
\end_inset

th tree.
 For a given 
\begin_inset Formula $p$
\end_inset

, the 
\begin_inset Formula $W$
\end_inset

 values for all trees in all cells can be sampled in parallel.
 
\end_layout

\begin_layout Standard
The conditional distribution of 
\begin_inset Formula $\alpha_{p}$
\end_inset

 is 
\begin_inset Formula 
\begin{align}
\alpha_{p} & \sim\mbox{N}\bigg(\Big(A+Q_{p}\Big)^{-1}A\bar{w}_{p},\Big(A+Q_{p}\Big)^{-1}\bigg).\label{sampalpha}
\end{align}

\end_inset

where 
\begin_inset Formula $Q_{p}=(\sigma_{p}^{2})^{-1}Q$
\end_inset

 for the CAR model and 
\begin_inset Formula $\left(\sigma_{p}^{2}\cdot\frac{4\pi}{\rho_{p}^{2}}\right)^{-1}Q(\rho_{p})$
\end_inset

 for the SPDE model.
 For each hyperparameter, 
\begin_inset Formula $\phi\in\{\{\mu_{p}\},\{\log\sigma_{p},\rho_{p}\}\}$
\end_inset

, we sampled 
\begin_inset Formula $\{\phi,\alpha_{p}\}$
\end_inset

 jointly, proposing 
\begin_inset Formula $\phi$
\end_inset

 as a random walk and, conditional on the proposed value of 
\begin_inset Formula $\phi$
\end_inset

, sampling 
\begin_inset Formula $\alpha_{p}$
\end_inset

 from the distribution just above.
 The joint proposal is accepted or rejected as a standard Metropolis-Hastings
 proposal, with adaptation of the proposal (co)variance 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
citep{Shab:Well:2011}
\end_layout

\end_inset

.
 As mentioned previously, for the SPDE model, we jointly proposed 
\begin_inset Formula $\phi=\{\log\sigma_{p},\rho_{p}\}$
\end_inset

 from a bivariate normal distribution to account for the posterior dependence
 of these parameters, while for the CAR model, 
\begin_inset Formula $\phi\in\{\{\log\sigma_{p}\}\}$
\end_inset

.
 
\end_layout

\begin_layout Standard
\noindent
\begin_inset Note Note
status open

\begin_layout Plain Layout
\noindent
The full conditional distribution of the hyperparameter 
\begin_inset Formula $\sigma_{p}^{2}$
\end_inset

 is 
\begin_inset Formula 
\begin{align}
[\sigma_{p}^{2}|y,w,\alpha,v_{-p}] & \sim IG\bigg(I/2+\beta_{p},\gamma_{p}+1/2\alpha_{p}^{T}(D-C)\alpha_{p}\bigg).\label{sampsigmasq}
\end{align}

\end_inset

Then 
\begin_inset Formula $\sigma_{p}^{2}$
\end_inset

 can be sampled from an inverse gamma distribution with shape parameter
 
\begin_inset Formula $I/2+\beta_{p}$
\end_inset

 and scale parameter 
\begin_inset Formula $\gamma_{p}+1/2\alpha_{p}^{T}(D-C)\alpha_{p}$
\end_inset

.
 In order to speed up computations, we take advantage of the sparsity of
 
\begin_inset Formula $C$
\end_inset

 to sample 
\begin_inset Formula $\alpha_{p}$
\end_inset

 using sparse matrix computations.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
For the township-level data, for a given tree, we draw the latent tree membershi
p variable, 
\begin_inset Formula $c_{tj}$
\end_inset

, from a discrete distribution by normalizing the weights, 
\begin_inset Formula $\{\psi_{1(t)}L_{1(t)},\ldots,\psi_{T(t)}L_{T(t)}\}$
\end_inset

 where 
\begin_inset Formula $L_{k}$
\end_inset

 is density of 
\begin_inset Formula $W_{tj\cdot}$
\end_inset

 if 
\begin_inset Formula $c_{tj}=k$
\end_inset

, namely the product of independent normal densities, 
\begin_inset Formula $W_{tjp}\sim\mbox{N}(\alpha_{p}(s_{k}),1)$
\end_inset

, over 
\begin_inset Formula $p=1,\ldots,P$
\end_inset

.
 Thus the posterior weights the prior based on how consistent the 
\begin_inset Formula $W$
\end_inset

 values are with the 
\begin_inset Formula $\alpha$
\end_inset

 values for the candidate grid cells.
 
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Subsection
Derivation of the Full Conditional Distribution of 
\begin_inset Formula $W$
\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fullconditionalW"

\end_inset


\end_layout

\begin_layout Plain Layout
The probability density function for the full conditional distribution of
 
\begin_inset Formula $W_{ijp}$
\end_inset

 is proportional to 
\begin_inset Formula 
\begin{align*}
 & \pi(w_{ijp}|y,w_{-ijp},\alpha,v)\propto\pi(y|w)\pi(w|\alpha)\\
 & \propto\bigg\{{\displaystyle \prod_{i=1}^{I}{\displaystyle \prod_{j=1}^{n_{i}}{\displaystyle \prod_{p=1}^{P}I(w_{ijy_{ij}}\geq w_{ijp})\bigg\}\bigg\{{\displaystyle \prod_{i=1}^{I}{\displaystyle \prod_{j=1}^{n_{i}}{\displaystyle \prod_{p=1}^{P}\phi(w_{ijp}-\alpha_{ip})\bigg\}}}}}}}
\end{align*}

\end_inset

The first product, taken over all observations 
\begin_inset Formula $j$
\end_inset

 at location 
\begin_inset Formula $i$
\end_inset

 and over all locations 
\begin_inset Formula $i$
\end_inset

, involves the indicator that 
\begin_inset Formula $w_{ijy_{ij}}$
\end_inset

 is greater than 
\begin_inset Formula $w_{ijp}$
\end_inset

 for all 
\begin_inset Formula $p$
\end_inset

.
 The second term involves the product of the conditionally-independent and
 normally-distributed 
\begin_inset Formula $W_{ijp}$
\end_inset

 given 
\begin_inset Formula $\alpha_{ip}$
\end_inset

, 
\begin_inset Formula $j$
\end_inset

 = 
\begin_inset Formula $1,...,n_{i}$
\end_inset

; 
\begin_inset Formula $i$
\end_inset

 = 
\begin_inset Formula $1,...,I$
\end_inset

; 
\begin_inset Formula $p$
\end_inset

 = 
\begin_inset Formula $1,...,P$
\end_inset

.
 Because the conditional distribution only depends on terms involving 
\begin_inset Formula $w_{ijp}$
\end_inset

, observe that this product simplifies to 
\begin_inset Formula 
\begin{align*}
 & \pi(w_{ijp}|y,w_{-ijp},\alpha,v)\\
 & \propto\begin{cases}
\phi(w_{ijy_{ij}}-\alpha_{iy_{ij}})I(w_{ijy_{ij}}\geq{\displaystyle \max_{p^{*}\neq y_{ij}}w_{ijp^{*}}),} & \mbox{if }p\mbox{ = \ensuremath{y_{ij}}}\\
\phi(w_{ijp}-\alpha_{ip})I(w_{ijp}\leq w_{ijy_{ij}}), & \mbox{if }p\mbox{ \ensuremath{\neq y_{ij}}}
\end{cases}
\end{align*}

\end_inset

That is, the full conditional distribution of 
\begin_inset Formula $W_{ijp}$
\end_inset

 is a truncated normal distribution with mean 
\begin_inset Formula $\alpha_{ip}$
\end_inset

 and variance 1.
 The truncation values are determined by the category of observation 
\begin_inset Formula $j$
\end_inset

 at location 
\begin_inset Formula $i$
\end_inset

.
 If the category is 
\begin_inset Formula $p$
\end_inset

, then the lower truncation value is 
\begin_inset Formula ${\displaystyle \max_{p^{*}\neq y_{ij}}w_{ijp^{*}}}$
\end_inset

 and the upper truncation value is 
\begin_inset Formula $\infty$
\end_inset

.
 If the category is 
\begin_inset Formula $q\neq p$
\end_inset

, then the lower truncation value is 
\begin_inset Formula $-\infty$
\end_inset

 and the upper truncation value is 
\begin_inset Formula $w_{ijq}$
\end_inset

.
\end_layout

\begin_layout Subsection
Derivation of the Full Conditional Distribution of 
\begin_inset Formula $\alpha_{p}$
\end_inset


\end_layout

\begin_layout Plain Layout
\noindent
\begin_inset CommandInset label
LatexCommand label
name "fullconditionalalpha"

\end_inset


\end_layout

\begin_layout Plain Layout
The full conditional distribution of 
\begin_inset Formula $\alpha_{p}$
\end_inset

 is 
\begin_inset Formula 
\begin{align*}
 & \pi(\alpha_{p}|y,w,\alpha_{-p},v)\propto\pi(w|\alpha)\pi(\alpha|v)\\
 & \propto\bigg[{\displaystyle \prod_{i=1}^{I}\exp\Big\{-(1/2){\displaystyle \sum_{j=1}^{n_{i}}(w_{ijp}-\alpha_{ip})^{2}\Big\}\bigg]\exp\bigg[-(1/2)\alpha_{p}^{T}\big\{\sigma_{p}^{-2}(D-C)\big\}\alpha_{p}\bigg]}}\\
 & \propto\bigg[{\displaystyle \prod_{i=1}^{I}\exp\Big\{-(1/2)(-2\alpha_{ip}{\displaystyle \sum_{j=1}^{n_{i}}w_{ijp}+n_{i}\alpha_{ip}^{2})\Big\}\bigg]\exp\bigg[-(1/2)\alpha_{p}^{T}\big\{\sigma_{p}^{-2}(D-C)\big\}\alpha_{p}\bigg]}}\\
 & \propto\bigg[{\displaystyle \prod_{i=1}^{I}\exp\Big\{-\frac{1}{2n_{i}^{-1}}(-2\bar{w}_{i.p}\alpha_{ip}+\alpha_{ip}^{2})\Big\}\bigg]\exp\bigg[-(1/2)\alpha_{p}^{T}\big\{\sigma_{p}^{-2}(D-C)\big\}\alpha_{p}\bigg]}\\
 & \propto\bigg[{\displaystyle \prod_{i=1}^{I}\exp\Big\{-(1/2)\frac{(\alpha_{ip}-\bar{w}_{i.p})^{2}}{n_{i}^{-1}}\Big\}\bigg]\exp\bigg[-(1/2)\alpha_{p}^{T}\big\{\sigma_{p}^{-2}(D-C)\big\}\alpha_{p}\bigg]}
\end{align*}

\end_inset

Above, the square was completed and the quadratic form in the first term
 was simplified.
 Next, we combine the two quadratic forms to obtain 
\begin_inset Formula 
\begin{align*}
 & \pi(\alpha_{p}|y,w,\alpha_{-p},v)\\
 & \propto\bigg[\exp\Big\{-(1/2)(\alpha_{p}-\bar{w}_{p})^{T}A(\alpha_{p}-\bar{w}_{p})\Big\}\bigg]\exp\bigg[-(1/2)\alpha_{p}^{T}\big\{\sigma_{p}^{-2}(D-C)\big\}\alpha_{p}\bigg]\\
 & \propto\exp\bigg[-(1/2)\bigg\{\alpha_{p}^{T}A\alpha_{p}-2\bar{w}_{p}^{T}A\alpha_{p}+\bar{w}_{p}^{T}A\bar{w}_{p}+\alpha_{p}^{T}V_{p}^{-1}\alpha_{p}\bigg\}\bigg]\\
 & \propto\exp\bigg[-(1/2)\bigg\{\alpha_{p}^{T}\big(A+V_{p}^{-1}\big)\alpha_{p}-2\bar{w}_{p}^{T}A\alpha_{p}\bigg\}\bigg]\\
 & \propto\exp\bigg[-(1/2)\bigg\{\big(A+V_{p}^{-1}\big)^{(1/2)}\alpha_{p}-\big(A+V_{p}^{-1}\big)^{-(1/2)}A\bar{w}_{p}\bigg\}^{T}\notag\\
 & \indent\indent\bigg\{\big(A+V_{p}^{-1}\big)^{(1/2)}\alpha_{p}-\big(A+V_{p}^{-1}\big)^{-(1/2)}A\bar{w}_{p}\bigg\}\bigg]\\
 & \propto\exp\bigg[-(1/2)\bigg\{\alpha_{p}-\big(A+V_{p}^{-1}\big)^{-1}A\bar{w}_{p}\bigg\}^{T}\big(A+V_{p}^{-1}\big)\notag\\
 & \indent\indent\bigg\{\alpha_{p}-\big(A+V_{p}^{-1}\big)^{-1}A\bar{w}_{p}\bigg\}\bigg]
\end{align*}

\end_inset

Above, the square was completed and the resulting terms were simplified.
 Thus, the full conditional distribution 
\begin_inset Formula $[\alpha_{p}|y,w,\alpha_{-p},v]$
\end_inset

 is a multivariate normal distribution 
\begin_inset Formula 
\begin{align*}
[\alpha_{p}|y,w,\alpha_{-p},v]\sim N\bigg(\big(A+V_{p}^{-1}\big)^{-1}A\bar{w}_{p},\big(A+V_{p}^{-1}\big)^{-1}\bigg).
\end{align*}

\end_inset

The mean vector 
\begin_inset Formula $\big(A+V_{p}^{-1}\big)^{-1}A\bar{w}$
\end_inset


\begin_inset Formula $_{p}$
\end_inset

 is a linear combination of the means of the latent variable values 
\begin_inset Formula $w_{ijp}$
\end_inset

 at each location for category 
\begin_inset Formula $p$
\end_inset

, and the values of 
\begin_inset Formula $\big(A+V_{p}^{-1}\big)^{-1}A$
\end_inset

 depend on the number of observations and number of neighbors at each location.
 Similarly, the covariance matrix 
\begin_inset Formula $\big(A+V_{p}^{-1}\big)^{-1}$
\end_inset

 varies by the number of observations and number of neighbors of each location.
\end_layout

\begin_layout Subsection
Derivation of the Full Conditional Distribution of Hyperparameter 
\begin_inset Formula $\sigma_{p}^{2}$
\end_inset

 
\end_layout

\begin_layout Plain Layout
\noindent
\begin_inset CommandInset label
LatexCommand label
name "fullconditionalsigmasq"

\end_inset


\end_layout

\begin_layout Plain Layout
The probability density function for the full conditional distribution of
 
\begin_inset Formula $\sigma_{p}^{2}$
\end_inset

 is proportional to 
\begin_inset Formula 
\begin{align*}
 & \pi(\sigma_{p}^{2}|y,w,\alpha,v_{-p})\propto\pi(\alpha_{p}|\sigma_{p}^{2})\pi(\sigma_{p}^{2})\\
 & \propto\bigg(|\sigma_{p}^{2}(D-C)^{-}|^{-1/2}\exp\Big[(-(1/2))\alpha_{p}^{T}\big\{\sigma_{p}^{-2}(D-C)\big\}\alpha_{p}\Big]\bigg)\exp(-\gamma_{p}\sigma_{p}^{2})(\sigma_{p}^{2})^{-\beta_{p}-1}\\
 & \propto(\sigma_{p}^{2})^{-I/2}\exp\bigg[-\Big\{\gamma_{p}+(1/2)\alpha_{p}^{T}(D-C)\alpha_{p}\Big\}\sigma_{p}^{-2}\bigg](\sigma_{p}^{2})^{-\beta_{p}-1}.
\end{align*}

\end_inset

Factors of the form 
\begin_inset Formula $\exp\{c(\sigma_{p}^{2})^{k}\}$
\end_inset

, where 
\begin_inset Formula $c$
\end_inset

 and 
\begin_inset Formula $k$
\end_inset

 are constants, were combined.
 Factors of the form 
\begin_inset Formula $(\sigma_{p}^{2})^{l}$
\end_inset

, where 
\begin_inset Formula $l$
\end_inset

 is a constant, were also combined, and the form of the density is that
 of the inverse gamma family.
 Thus, 
\begin_inset Formula 
\begin{align*}
[\sigma_{p}^{2}|y,w,\alpha,v_{-p}]\sim IG\bigg(I/2+\beta_{p},\gamma_{p}+(1/2)\alpha_{p}^{T}(D-C)\alpha_{p}\bigg).
\end{align*}

\end_inset

The shape parameter is 
\begin_inset Formula $I/2+\beta_{p}$
\end_inset

, and the scale parameter is 
\begin_inset Formula $\gamma_{p}+(1/2)\alpha_{p}^{T}(D-C)\alpha_{p}$
\end_inset

.
 More variability in 
\begin_inset Formula $\alpha_{p}$
\end_inset

 yields larger values of the quadratic form 
\begin_inset Formula $\alpha_{p}^{T}(D-C)\alpha_{p}$
\end_inset

, and thus, the full conditional distribution of 
\begin_inset Formula $\sigma_{p}^{2}$
\end_inset

 will have a larger mean.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Estimating 
\begin_inset Formula $\theta_{p}(s)$
\end_inset

 via Monte Carlo integration
\end_layout

\begin_layout Standard
In the latent variable representation, 
\begin_inset Formula $\theta_{p}(s)$
\end_inset

 never appears explicitly and cannot be calculated in close form.
 Instead we use Monte Carlo integration over 
\begin_inset Formula $W_{ijp},\, p=1,\ldots,P$
\end_inset

 to estimate 
\begin_inset Formula $\theta_{p}(s_{i})$
\end_inset

.
 The quantity 
\begin_inset Formula $\theta_{p}(s_{i})=P(W_{ijp}={\displaystyle \max_{p^{*}}W_{ijp^{*}})}$
\end_inset

 defines the probability of taxon 
\begin_inset Formula $p$
\end_inset

 at grid cell 
\begin_inset Formula $i$
\end_inset

.
 This requires one to choose the number of Monte Carlo samples, which we
 set at 10000.
 For each of the saved MCMC samples, 
\begin_inset Formula $k=1,\ldots K$
\end_inset

, we estimate 
\begin_inset Formula $\theta_{p}^{(k)}(s_{i})$
\end_inset

 numerically.
 Specifically, for 
\begin_inset Formula $t=1,\ldots,10000$
\end_inset

, we independently draw
\begin_inset Formula 
\[
W_{ijpt}^{(k)}\sim\mbox{N}(\alpha_{p}^{(k)}(s_{i}),1),\, p=1,\ldots,P
\]

\end_inset

and estimate 
\begin_inset Formula 
\[
\hat{\theta}_{p}^{(k)}(s_{i})=\frac{1}{10000}{\displaystyle \sum_{t=1}^{10000}1(W_{ijpt}^{(k)}={\displaystyle \max_{p^{*}}W_{ijp^{*}t}^{(k)})}}
\]

\end_inset

where 
\begin_inset Formula $1(\cdot)$
\end_inset

 is the indicator function that evaluates to 1 if the expression is true
 and 0 if false.
 In other words, we calculate the proportion of times that the maximum of
 
\begin_inset Formula $W_{ijp},\, p=1,\ldots,P$
\end_inset

 corresponds to taxon 
\begin_inset Formula $p$
\end_inset

.
 Considering 
\begin_inset Formula $\hat{\theta}_{p}^{(k)}(s_{i}),\, k=1,\ldots,K$
\end_inset

, we have a sample from the posterior of 
\begin_inset Formula $\theta_{p}(s_{i})$
\end_inset

.
\end_layout

\end_body
\end_document
